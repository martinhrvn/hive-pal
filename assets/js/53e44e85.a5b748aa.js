"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[108],{3939:(e,a,s)=>{s.d(a,{R:()=>c,x:()=>i});var n=s(8225);const l={},r=n.createContext(l);function c(e){const a=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function i(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:c(e.components),n.createElement(r.Provider,{value:a},e.children)}},8779:(e,a,s)=>{s.r(a),s.d(a,{assets:()=>t,contentTitle:()=>i,default:()=>p,frontMatter:()=>c,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"self-hosting/backup-restore","title":"Backup & Restore","description":"Protect your beekeeping data with reliable backup and restore procedures.","source":"@site/docs/self-hosting/backup-restore.md","sourceDirName":"self-hosting","slug":"/self-hosting/backup-restore","permalink":"/docs/self-hosting/backup-restore","draft":false,"unlisted":false,"editUrl":"https://github.com/martinhrvn/hive-pal/tree/main/docs/docs/self-hosting/backup-restore.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"Backup & Restore"},"sidebar":"tutorialSidebar","previous":{"title":"Configuration","permalink":"/docs/self-hosting/configuration"},"next":{"title":"Monitoring","permalink":"/docs/self-hosting/monitoring"}}');var l=s(7557),r=s(3939);const c={sidebar_position:5,title:"Backup & Restore"},i="Backup & Restore",t={},o=[{value:"Automated Backups",id:"automated-backups",level:2},{value:"Database Backups",id:"database-backups",level:3},{value:"File Backups",id:"file-backups",level:3},{value:"Cron Scheduling",id:"cron-scheduling",level:3},{value:"Manual Backups",id:"manual-backups",level:2},{value:"Database Export",id:"database-export",level:3},{value:"Specific Tables",id:"specific-tables",level:3},{value:"Files Export",id:"files-export",level:3},{value:"Docker Backups",id:"docker-backups",level:2},{value:"Container Data",id:"container-data",level:3},{value:"Full Stack Backup",id:"full-stack-backup",level:3},{value:"Restore Procedures",id:"restore-procedures",level:2},{value:"Database Restore",id:"database-restore",level:3},{value:"Partial Restore",id:"partial-restore",level:3},{value:"File Restore",id:"file-restore",level:3},{value:"Docker Restore",id:"docker-restore",level:3},{value:"Cloud Backups",id:"cloud-backups",level:2},{value:"AWS S3",id:"aws-s3",level:3},{value:"Google Cloud Storage",id:"google-cloud-storage",level:3},{value:"Monitoring Backups",id:"monitoring-backups",level:2},{value:"Backup Verification",id:"backup-verification",level:3},{value:"Automated Testing",id:"automated-testing",level:3},{value:"Disaster Recovery",id:"disaster-recovery",level:2},{value:"Recovery Planning",id:"recovery-planning",level:3},{value:"Emergency Procedures",id:"emergency-procedures",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Backup Strategy",id:"backup-strategy",level:3},{value:"Security",id:"security",level:3},{value:"Documentation",id:"documentation",level:3},{value:"Automation",id:"automation",level:3}];function d(e){const a={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a.header,{children:(0,l.jsx)(a.h1,{id:"backup--restore",children:"Backup & Restore"})}),"\n",(0,l.jsx)(a.p,{children:"Protect your beekeeping data with reliable backup and restore procedures."}),"\n",(0,l.jsx)(a.h2,{id:"automated-backups",children:"Automated Backups"}),"\n",(0,l.jsx)(a.h3,{id:"database-backups",children:"Database Backups"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:'#!/bin/bash\n# backup-db.sh\nDATE=$(date +%Y%m%d_%H%M%S)\nBACKUP_DIR="/backups/database"\nmkdir -p $BACKUP_DIR\n\n# PostgreSQL backup\npg_dump -U postgres hivepal | gzip > $BACKUP_DIR/hivepal_$DATE.sql.gz\n\n# Cleanup old backups (keep 30 days)\nfind $BACKUP_DIR -name "*.sql.gz" -mtime +30 -delete\n'})}),"\n",(0,l.jsx)(a.h3,{id:"file-backups",children:"File Backups"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:'#!/bin/bash  \n# backup-files.sh\nDATE=$(date +%Y%m%d_%H%M%S)\nBACKUP_DIR="/backups/files"\nUPLOAD_DIR="/var/lib/hive-pal/uploads"\n\nmkdir -p $BACKUP_DIR\ntar -czf $BACKUP_DIR/uploads_$DATE.tar.gz -C $UPLOAD_DIR .\n'})}),"\n",(0,l.jsx)(a.h3,{id:"cron-scheduling",children:"Cron Scheduling"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Add to crontab\ncrontab -e\n\n# Database backup daily at 2 AM\n0 2 * * * /scripts/backup-db.sh\n\n# File backup daily at 3 AM  \n0 3 * * * /scripts/backup-files.sh\n\n# Weekly full backup\n0 1 * * 0 /scripts/backup-full.sh\n"})}),"\n",(0,l.jsx)(a.h2,{id:"manual-backups",children:"Manual Backups"}),"\n",(0,l.jsx)(a.h3,{id:"database-export",children:"Database Export"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Full database\npg_dump -U postgres -h localhost hivepal > backup.sql\n\n# Schema only\npg_dump -U postgres -h localhost --schema-only hivepal > schema.sql\n\n# Data only\npg_dump -U postgres -h localhost --data-only hivepal > data.sql\n"})}),"\n",(0,l.jsx)(a.h3,{id:"specific-tables",children:"Specific Tables"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Backup specific tables\npg_dump -U postgres -h localhost -t users -t apiaries hivepal > partial.sql\n"})}),"\n",(0,l.jsx)(a.h3,{id:"files-export",children:"Files Export"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Copy upload directory\ncp -r /var/lib/hive-pal/uploads /backups/uploads_backup\n\n# Create compressed archive\ntar -czf uploads_backup.tar.gz uploads/\n"})}),"\n",(0,l.jsx)(a.h2,{id:"docker-backups",children:"Docker Backups"}),"\n",(0,l.jsx)(a.h3,{id:"container-data",children:"Container Data"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Database container backup\ndocker-compose exec postgres pg_dump -U postgres hivepal > backup.sql\n\n# Volume backup\ndocker run --rm -v hive-pal_postgres_data:/data -v $(pwd):/backup alpine tar czf /backup/postgres_data.tar.gz /data\n"})}),"\n",(0,l.jsx)(a.h3,{id:"full-stack-backup",children:"Full Stack Backup"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Stop containers\ndocker-compose down\n\n# Backup volumes\ndocker run --rm -v hive-pal_postgres_data:/postgres -v hive-pal_uploads:/uploads -v $(pwd):/backup alpine tar czf /backup/full_backup.tar.gz /postgres /uploads\n\n# Restart\ndocker-compose up -d\n"})}),"\n",(0,l.jsx)(a.h2,{id:"restore-procedures",children:"Restore Procedures"}),"\n",(0,l.jsx)(a.h3,{id:"database-restore",children:"Database Restore"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Drop and recreate database\ndropdb -U postgres hivepal\ncreatedb -U postgres hivepal\n\n# Restore from backup\npsql -U postgres hivepal < backup.sql\n\n# Or from compressed backup\ngunzip -c backup.sql.gz | psql -U postgres hivepal\n"})}),"\n",(0,l.jsx)(a.h3,{id:"partial-restore",children:"Partial Restore"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:'# Restore specific tables\npsql -U postgres hivepal < partial_backup.sql\n\n# Restore with conflict handling\npsql -U postgres hivepal -c "TRUNCATE TABLE users CASCADE;"\npsql -U postgres hivepal < users_backup.sql\n'})}),"\n",(0,l.jsx)(a.h3,{id:"file-restore",children:"File Restore"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Restore uploads directory\nrm -rf /var/lib/hive-pal/uploads\ntar -xzf uploads_backup.tar.gz -C /var/lib/hive-pal/\n\n# Set permissions\nchown -R hive-pal:hive-pal /var/lib/hive-pal/uploads\nchmod -R 755 /var/lib/hive-pal/uploads\n"})}),"\n",(0,l.jsx)(a.h3,{id:"docker-restore",children:"Docker Restore"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Stop containers\ndocker-compose down\n\n# Restore volumes\ndocker run --rm -v hive-pal_postgres_data:/data -v $(pwd):/backup alpine tar xzf /backup/postgres_data.tar.gz -C /\n\n# Start containers\ndocker-compose up -d\n\n# Run migrations if needed\ndocker-compose exec backend npm run migrate\n"})}),"\n",(0,l.jsx)(a.h2,{id:"cloud-backups",children:"Cloud Backups"}),"\n",(0,l.jsx)(a.h3,{id:"aws-s3",children:"AWS S3"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Install AWS CLI\naws configure\n\n# Upload backup\naws s3 cp backup.sql.gz s3://your-backup-bucket/hive-pal/$(date +%Y%m%d)/\n\n# Download backup\naws s3 cp s3://your-backup-bucket/hive-pal/20241201/backup.sql.gz .\n"})}),"\n",(0,l.jsx)(a.h3,{id:"google-cloud-storage",children:"Google Cloud Storage"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Install gcloud\ngcloud auth login\n\n# Upload\ngsutil cp backup.sql.gz gs://your-backup-bucket/hive-pal/\n\n# Download  \ngsutil cp gs://your-backup-bucket/hive-pal/backup.sql.gz .\n"})}),"\n",(0,l.jsx)(a.h2,{id:"monitoring-backups",children:"Monitoring Backups"}),"\n",(0,l.jsx)(a.h3,{id:"backup-verification",children:"Backup Verification"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:'#!/bin/bash\n# verify-backup.sh\n\n# Check if backup file exists and is recent\nBACKUP_FILE="/backups/database/$(date +%Y%m%d)_*.sql.gz"\nif [ ! -f $BACKUP_FILE ]; then\n    echo "ERROR: No backup found for today"\n    exit 1\nfi\n\n# Check backup file size\nSIZE=$(stat -f%z $BACKUP_FILE 2>/dev/null || stat -c%s $BACKUP_FILE)\nif [ $SIZE -lt 1000000 ]; then  # Less than 1MB\n    echo "WARNING: Backup file seems too small"\nfi\n\necho "Backup verification complete"\n'})}),"\n",(0,l.jsx)(a.h3,{id:"automated-testing",children:"Automated Testing"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Test restore process\ncreatedb test_restore\ngunzip -c backup.sql.gz | psql test_restore\ndropdb test_restore\n"})}),"\n",(0,l.jsx)(a.h2,{id:"disaster-recovery",children:"Disaster Recovery"}),"\n",(0,l.jsx)(a.h3,{id:"recovery-planning",children:"Recovery Planning"}),"\n",(0,l.jsxs)(a.ol,{children:["\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.strong,{children:"Identify critical data"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.strong,{children:"Set recovery time objectives (RTO)"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.strong,{children:"Set recovery point objectives (RPO)"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.strong,{children:"Document procedures"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.strong,{children:"Test regularly"})}),"\n"]}),"\n",(0,l.jsx)(a.h3,{id:"emergency-procedures",children:"Emergency Procedures"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Quick restore checklist\n# 1. Stop application\nsudo systemctl stop hive-pal\n\n# 2. Restore database\ndropdb hivepal && createdb hivepal\npsql hivepal < latest_backup.sql\n\n# 3. Restore files\ntar -xzf latest_files_backup.tar.gz -C /var/lib/hive-pal/\n\n# 4. Start application\nsudo systemctl start hive-pal\n"})}),"\n",(0,l.jsx)(a.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,l.jsx)(a.h3,{id:"backup-strategy",children:"Backup Strategy"}),"\n",(0,l.jsxs)(a.ul,{children:["\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.strong,{children:"3-2-1 Rule"}),": 3 copies, 2 different media, 1 offsite"]}),"\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.strong,{children:"Regular schedule"}),": Daily database, weekly files"]}),"\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.strong,{children:"Test restores"}),": Monthly verification"]}),"\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.strong,{children:"Monitor success"}),": Automated alerts"]}),"\n"]}),"\n",(0,l.jsx)(a.h3,{id:"security",children:"Security"}),"\n",(0,l.jsxs)(a.ul,{children:["\n",(0,l.jsx)(a.li,{children:"Encrypt backup files"}),"\n",(0,l.jsx)(a.li,{children:"Secure storage locations"}),"\n",(0,l.jsx)(a.li,{children:"Access control"}),"\n",(0,l.jsx)(a.li,{children:"Audit backup access"}),"\n"]}),"\n",(0,l.jsx)(a.h3,{id:"documentation",children:"Documentation"}),"\n",(0,l.jsxs)(a.ul,{children:["\n",(0,l.jsx)(a.li,{children:"Keep recovery procedures updated"}),"\n",(0,l.jsx)(a.li,{children:"Document backup locations"}),"\n",(0,l.jsx)(a.li,{children:"Maintain restore checklists"}),"\n",(0,l.jsx)(a.li,{children:"Train team members"}),"\n"]}),"\n",(0,l.jsx)(a.h3,{id:"automation",children:"Automation"}),"\n",(0,l.jsxs)(a.ul,{children:["\n",(0,l.jsx)(a.li,{children:"Use configuration management"}),"\n",(0,l.jsx)(a.li,{children:"Monitor backup jobs"}),"\n",(0,l.jsx)(a.li,{children:"Alert on failures"}),"\n",(0,l.jsx)(a.li,{children:"Verify backup integrity"}),"\n"]})]})}function p(e={}){const{wrapper:a}={...(0,r.R)(),...e.components};return a?(0,l.jsx)(a,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}}}]);